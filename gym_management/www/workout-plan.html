<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Workout Plan Details</title>

    <style>
        body {
            padding: 20px;
            background: #f5f5f5;
            font-family: Arial, sans-serif;
        }

        .content-box {
            background: #fff;
            padding: 30px;
            border-radius: 12px;
            max-width: 900px;
            margin: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            border: 1px solid #ccc;
            padding: 8px;
        }

        th {
            background: #eee;
        }
    </style>
</head>

<body>

<div class="content-box">
    <h1>Workout Plan Details</h1>
    <div id="plan-details">Loading...</div>
</div>

<script>
async function fetchWorkoutPlan() {
    const params = new URLSearchParams(window.location.search);
    const planName = params.get("name");

    if (!planName) {
        document.getElementById("plan-details").innerHTML = "Invalid Workout Plan.";
        return;
    }

    try {
        // Include all fields to get child table
        const response = await fetch(`/api/resource/Gym Workout Plan/${planName}?fields=["*"]`);
        if (!response.ok) throw new Error("Workout Plan not found or API error.");
        
        const result = await response.json();
        const plan = result.data;

        let html = `
            <p><strong>Plan Name:</strong> ${plan.plan_name || "-"}</p>
            <p><strong>Level:</strong> ${plan.levels || "-"}</p>
            <p><strong>Description:</strong> ${plan.description || "-"}</p>
        `;

        const exercises = plan.gym_workout_plan || [];

        if (exercises.length) {
            html += `
                <h2>Exercises</h2>
                <table>
                    <tr>
                        <th>Exercise Name</th>
                        <th>Sets</th>
                        <th>Reps</th>
                    </tr>
            `;
            exercises.forEach(ex => {
                html += `
                    <tr>
                        <td>${ex.exercise_name || "-"}</td>
                        <td>${ex.sets || "-"}</td>
                        <td>${ex.reps || "-"}</td>
                    </tr>
                `;
            });
            html += `</table>`;
        } else {
            html += `<p>No exercises added.</p>`;
        }

        document.getElementById("plan-details").innerHTML = html;

    } catch (error) {
        console.error(error);
        document.getElementById("plan-details").innerHTML = "Error loading Workout Plan.";
    }
}


fetchWorkoutPlan();
</script>

</body>
</html>